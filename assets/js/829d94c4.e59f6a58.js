"use strict";(self.webpackChunkit_3038c=self.webpackChunkit_3038c||[]).push([[19],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>h});var o=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=o.createContext({}),p=function(e){var t=o.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},u=function(e){var t=p(e.components);return o.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},c=o.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,s=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),c=p(n),h=a,k=c["".concat(s,".").concat(h)]||c[h]||d[h]||r;return n?o.createElement(k,l(l({ref:t},u),{},{components:n})):o.createElement(k,l({ref:t},u))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,l=new Array(r);l[0]=c;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i.mdxType="string"==typeof e?e:a,l[1]=i;for(var p=2;p<r;p++)l[p]=n[p];return o.createElement.apply(null,l)}return o.createElement.apply(null,n)}c.displayName="MDXCreateElement"},2091:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>l,default:()=>d,frontMatter:()=>r,metadata:()=>i,toc:()=>p});var o=n(7462),a=(n(7294),n(3905));const r={title:"Module 11 \u2013 Hosting and Deploying",sidebar_position:11,slug:"/11"},l=void 0,i={unversionedId:"module-11",id:"module-11",title:"Module 11 \u2013 Hosting and Deploying",description:"Heroku is no longer free. I recommend using Fly.io instead but have not had time to re-write this module",source:"@site/content/modules/module-11.md",sourceDirName:".",slug:"/11",permalink:"/modules/11",draft:!1,tags:[],version:"current",sidebarPosition:11,frontMatter:{title:"Module 11 \u2013 Hosting and Deploying",sidebar_position:11,slug:"/11"},sidebar:"defaultSidebar",previous:{title:"Module 10 \u2013 Working with APIs",permalink:"/modules/10"},next:{title:"Module 12 \u2013 Websites in Python using Flask",permalink:"/modules/12"}},s={},p=[{value:"Heroku is no longer free. I recommend using Fly.io instead but have not had time to re-write this module",id:"heroku-is-no-longer-free-i-recommend-using-flyio-instead-but-have-not-had-time-to-re-write-this-module",level:2},{value:"Setting up Heroku",id:"setting-up-heroku",level:2},{value:"Code Considerations",id:"code-considerations",level:3},{value:"Deploying Code for Production",id:"deploying-code-for-production",level:2},{value:"Code based on ENV",id:"code-based-on-env",level:2},{value:"Create a Heroku app",id:"create-a-heroku-app",level:2},{value:"Lab 10",id:"lab-10",level:2}],u={toc:p};function d(e){let{components:t,...r}=e;return(0,a.kt)("wrapper",(0,o.Z)({},u,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"heroku-is-no-longer-free-i-recommend-using-flyio-instead-but-have-not-had-time-to-re-write-this-module"},"Heroku is no longer free. I recommend using Fly.io instead but have not had time to re-write this module"),(0,a.kt)("p",null,"List of Links for this week"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://fly.io/"},"https://fly.io/"))),(0,a.kt)("h2",{id:"setting-up-heroku"},"Setting up Heroku"),(0,a.kt)("p",null,"Let's create a Heroku account. To do this, click the link above and create follow the instructions to create an account. Windows or Linux is fine. I'm using Windows because a lot of browser work will need to happen."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"npm install -g heroku\n")),(0,a.kt)("p",null,"Once Heroku is installed, run"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"heroku login\n")),(0,a.kt)("p",null,"This will prompt you to login or open a browser to complete your login. If it fails, CTRL-C the script and re-run it. You may have to set your default browser to Firefox or Chrome on your server to complete this step."),(0,a.kt)("p",null,'Enter your email address and password. Return to the terminal and you should see a "logged in as" message, indicating a successful login.'),(0,a.kt)("h3",{id:"code-considerations"},"Code Considerations"),(0,a.kt)("p",null,"If you're storing your code on a public remote repo like github.com, it's important to protect your passwords and machines. Scrapers are constantly checking newly added repos for passwords that were left in the code so that they can use them to access your data."),(0,a.kt)("p",null,"Here are a few ways you can protect your code:"),(0,a.kt)("p",null,"Have a template file for your config, but keep the real file in your .gitignore"),(0,a.kt)("p",null,"Store your passwords as environment variables, not in your code"),(0,a.kt)("p",null,"Hash your passwords in code \u2013 this is much more difficult and using env variables is much better."),(0,a.kt)("h2",{id:"deploying-code-for-production"},"Deploying Code for Production"),(0,a.kt)("p",null,"Let's walk through a scenario where you might deploy and application."),(0,a.kt)("p",null,"To do this, we're going to use Heroku. We're also going to create a simple app to host there."),(0,a.kt)("p",null,"If using github on Linux, run:"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"yum update -y nss curl libcurl")),(0,a.kt)("p",null,"On Windows or Linux, run:"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"git clone https://github.com/heroku/node-js-sample.git")),(0,a.kt)("p",null,"If you're having trouble with github, you can download the file at"),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/heroku/node-js-sample/archive/master.zip"},"https://github.com/heroku/node-js-sample/archive/master.zip")),(0,a.kt)("p",null,"Open this directory in VSCode."),(0,a.kt)("p",null,"Find the ",(0,a.kt)("inlineCode",{parentName:"p"},"index.js")," file and edit it. You'll notice there is a bit of code already written for you. This invokes the ",(0,a.kt)("inlineCode",{parentName:"p"},"express")," module, a popular NodeJS module for web servers."),(0,a.kt)("p",null,"At the top of the file, add"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const config = require('config')\n")),(0,a.kt)("p",null,"Edit ",(0,a.kt)("inlineCode",{parentName:"p"},"response.send")," to include ",(0,a.kt)("inlineCode",{parentName:"p"},"config.util.getEnv('MYNAME')")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"config.util.getEnv('NODE_ENV')"),", something like this:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"response.send('<b>Hello World! My name is:<em>' + process.env.MYNAME + '</em> <br /> My Node Environment is:<em>' + config.util.getEnv('NODE_ENV') + '</em></b>')\n")),(0,a.kt)("p",null,"Go ahead and open the terminal in VSCode and run:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"npm install\nnpm install config\n")),(0,a.kt)("p",null,'NPM install will install all of the modules listed in the delivered "package.json" file. We also install the config module. Config gives us options for assigning environment variables.'),(0,a.kt)("p",null,"Two ways to set environment variables:"),(0,a.kt)("p",null,"Set a system environment variable from the command line, run:"),(0,a.kt)("p",null,"On Linux:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"export NODE_ENV='Testing'\n")),(0,a.kt)("p",null,"On Windows:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-powershell"},"$env:NODE_ENV='Testing'\n")),(0,a.kt)("p",null,"Start the application"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"node index\n")),(0,a.kt)("p",null,"Browse to ",(0,a.kt)("a",{parentName:"p",href:"http://localhost:5000"},"http://localhost:5000")," in your browser"),(0,a.kt)("p",null,"You should see something like this:"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Screenshot of running app without proper ENV set",src:n(4845).Z,width:"656",height:"87"})),(0,a.kt)("p",null,"We need to define our variable for ",(0,a.kt)("inlineCode",{parentName:"p"},"MYNAME"),", but let's do that a different way."),(0,a.kt)("p",null,"Set the variable before launching the node app. From the command line, run:"),(0,a.kt)("p",null,"On Linux, run"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"MYNAME='reedws' node index\n")),(0,a.kt)("p",null,"You can also override the port"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"NODE_ENV='Testing' MYNAME='reedws' PORT=5001 NODE_ENV='Testing' node index\n")),(0,a.kt)("p",null,"This will run the app on Port ",(0,a.kt)("inlineCode",{parentName:"p"},"5001"),"."),(0,a.kt)("p",null,"On Windows, you can't run variable in-line, so you have to set them like we did above."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-powershell"},"$env:MYNAME='reedws'\n\n$env:PORT='5001'\n")),(0,a.kt)("p",null,"Restart the process"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"node index\n")),(0,a.kt)("p",null,"Launch your web browser to ",(0,a.kt)("a",{parentName:"p",href:"http://localhost:5001"},"http://localhost:5001")," and confirm the app is working as expected."),(0,a.kt)("p",null,"It should look something like this:"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Screenshot of running app with proper ENV set",src:n(3689).Z,width:"648",height:"58"})),(0,a.kt)("h2",{id:"code-based-on-env"},"Code based on ENV"),(0,a.kt)("p",null,"Knowing that we have the ability to check for our environment variable, we can make accommodations in our code. Right after we send our first response, we can add a bit more code to check for our ENV and change our output. Modify your app.get code to look something like this:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},'app.get(\'/env\', (request, response) => {\n  if (config.util.getEnv("NODE_ENV") === "Testing") {\n    response.send(\'<b>You are working in the <em>TEST</em> environment.</b>\')\n  } else if (config.util.getEnv("NODE_ENV") === "Heroku Test") {\n    response.send(\'<b>You are working in the <em>TEST</em> environment that is in Heroku.</b>\')\n  } else if (config.util.getEnv("NODE_ENV") === "Production") {\n    response.send(\'<b>You are working in Production</b>\')\n  } else {\n    response.send(\'<b>Environment is unknown</b>\')\n  }\n})\n')),(0,a.kt)("p",null,"Restart the application and browse to it. Include ",(0,a.kt)("inlineCode",{parentName:"p"},"/env")," at the end ",(0,a.kt)("a",{parentName:"p",href:"http://localhost:5001/env"},"http://localhost:5001/env")),(0,a.kt)("h2",{id:"create-a-heroku-app"},"Create a Heroku app"),(0,a.kt)("p",null,"To create an app in Heroku, login to the web interface at ",(0,a.kt)("a",{parentName:"p",href:"https://dashboard.heroku.com/apps"},"https://dashboard.heroku.com/apps")),(0,a.kt)("p",null,"From the dashboard, click New | Create New App."),(0,a.kt)("p",null,"Call the app whatever you want, but it has to be distinct. Something like username-date is usually a safe bet."),(0,a.kt)("p",null,"Click Create App."),(0,a.kt)("p",null,"There is a section on the following page that shows you how to deploy."),(0,a.kt)("p",null,"Let's follow these steps. We've already logged in, so we can skip the first step. We'll need to initialize our new repo"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"git init\n\nheroku git:remote \u2013a <NAME OF YOUR APP>\n\ngit add .\n\ngit commit \u2013m 'my first heroku app'\n\ngit push heroku master\n")),(0,a.kt)("p",null,"You will get an error! That's ok! Let's find out what it is."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"heroku logs\n")),(0,a.kt)("p",null,"Oh, we forgot to tell our app about our dependency on the configs package. This is in our package.json. We can add it manually, or we can add it from CLI. Let's run"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"npm install config --save\n")),(0,a.kt)("p",null,"We also need to change the version of Node that this app runs as. Open the package.json file again and change"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'"engines": {\n  "node": "4.0.0"\n},\n')),(0,a.kt)("p",null,"To"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'"engines": {\n  "node": ">=16.0.0"\n},\n')),(0,a.kt)("p",null,"Then run\u2026"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"git add .\n\ngit commit \u2013m 'heroku ready'\n\ngit push heroku master\n")),(0,a.kt)("p",null,"There does not appear to be any errors now. We can browse to our app at"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"https://<name_of_heroku_app>.herokuapp.com")),(0,a.kt)("p",null,"You can also click ",(0,a.kt)("inlineCode",{parentName:"p"},"Open App")," from the Heroku window or type ",(0,a.kt)("inlineCode",{parentName:"p"},"heroku open")," in your terminal."),(0,a.kt)("p",null,"Our app works, as expected, but it's not giving us the ",(0,a.kt)("inlineCode",{parentName:"p"},"Environment Variables")," that we set on our local machines."),(0,a.kt)("p",null,"We need to create these ",(0,a.kt)("inlineCode",{parentName:"p"},"Environment Variables")," within Heroku in order to get them to work."),(0,a.kt)("p",null,"In our Heroku app, go to ",(0,a.kt)("inlineCode",{parentName:"p"},"Settings")),(0,a.kt)("p",null,"Click ",(0,a.kt)("inlineCode",{parentName:"p"},"Reveal Config Vars")),(0,a.kt)("p",null,"You'll see an option for KEY VALUE pairs."),(0,a.kt)("p",null,"Create a ",(0,a.kt)("inlineCode",{parentName:"p"},"NODE_ENV")," value and set it to ",(0,a.kt)("inlineCode",{parentName:"p"},"HerokuTest")),(0,a.kt)("p",null,"Also create our ",(0,a.kt)("inlineCode",{parentName:"p"},"MYNAME")," variable and set it to your username. It should look something like this."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Screenshot of Heroku Environment Vars Section",src:n(5736).Z,width:"693",height:"194"})),(0,a.kt)("p",null,"Reopen the application and verify it looks similar to this."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Screenshot of app running on Heroku",src:n(7160).Z,width:"671",height:"163"})),(0,a.kt)("h2",{id:"lab-10"},"Lab 10"),(0,a.kt)("p",null,"Using the code you wrote for Lab 9, create a new route at /api that includes the content of the file widgets.json we used last week. Submit the URL of your Heroku app that returns the contents of widgets.json at /api"),(0,a.kt)("p",null,'Your final page should look like this example, including your correct username, a Heroku environment other than "Development" and a working API link:'),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://it3038c-heroku.herokuapp.com/"},"https://it3038c-heroku.herokuapp.com/")),(0,a.kt)("p",null,"Here are a few hints:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Using the example for checking /env, you can create another route for /api. Don't over think it."),(0,a.kt)("li",{parentName:"ul"},"Refer to last week's NodeJS code. You'll need the file, the data and a response."),(0,a.kt)("li",{parentName:"ul"},"Your widgets.json file needs to get sent to Heroku and you need to point to it without knowing the full path. A relative path should do (eg. ./public/widgets.json)")))}d.isMDXComponent=!0},4845:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/1-running-app-no-env-4bdac266d12d015b86d745c4ec316f0d.png"},3689:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/2-running-app-with-env-4dee99c6f8400406c2c9791594a6eba8.png"},5736:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/3-heroku-vars-f67c19cc4f13453957457b792ae8a07f.png"},7160:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/4-running-app-heroku-3f6b427728c6ea46309300688d8fa937.png"}}]);